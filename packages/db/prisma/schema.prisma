generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model House {
  id             String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  osmId          BigInt?         @map("osm_id")
  geometry       Unsupported("geometry(Polygon, 4326)")?
  centroid       Unsupported("geometry(Point, 4326)")?
  addressStreet  String?         @map("address_street") @db.VarChar(255)
  addressNumber  String?         @map("address_number") @db.VarChar(50)
  addressCity    String?         @map("address_city") @db.VarChar(100)
  addressPostcode String?        @map("address_postcode") @db.VarChar(20)
  buildingType   String?         @map("building_type") @db.VarChar(50)
  buildingLevels Int?            @map("building_levels") @db.SmallInt
  areaSqm        Decimal?        @map("area_sqm") @db.Decimal(10, 2)
  createdAt      DateTime        @default(now()) @map("created_at") @db.Timestamptz
  updatedAt      DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  
  priceEstimates PriceEstimate[]
  listings       LightListing[]

  @@map("houses")
}

model PriceEstimate {
  id           String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  houseId      String   @map("house_id") @db.Uuid
  rentMin      Decimal? @map("rent_min") @db.Decimal(10, 2)
  rentMax      Decimal? @map("rent_max") @db.Decimal(10, 2)
  saleMin      Decimal? @map("sale_min") @db.Decimal(12, 2)
  saleMax      Decimal? @map("sale_max") @db.Decimal(12, 2)
  confidence   Decimal? @db.Decimal(3, 2)
  calculatedAt DateTime @default(now()) @map("calculated_at") @db.Timestamptz
  factors      Json?

  house House @relation(fields: [houseId], references: [id], onDelete: Cascade)

  @@index([houseId])
  @@index([calculatedAt])
  @@map("price_estimates")
}

model LightListing {
  id           String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  houseId      String?   @map("house_id") @db.Uuid
  listingType  String    @map("listing_type") @db.VarChar(20)
  price        Decimal   @db.Decimal(12, 2)
  contactEmail String    @map("contact_email") @db.VarChar(255)
  contactPhone String?   @map("contact_phone") @db.VarChar(50)
  description  String?
  isActive     Boolean   @default(true) @map("is_active")
  createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz
  expiresAt    DateTime? @map("expires_at") @db.Timestamptz

  house House? @relation(fields: [houseId], references: [id], onDelete: SetNull)

  @@index([houseId])
  @@index([isActive])
  @@index([listingType])
  @@map("light_listings")
}
